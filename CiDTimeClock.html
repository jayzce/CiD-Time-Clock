<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Time Clock | Production System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            width: 95%;
            max-width: 1000px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 4s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .current-time {
            font-size: 1.8rem;
            color: white;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
        }

        .employee-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .employee-input {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            outline: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .employee-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .button-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .clock-button {
            padding: 20px 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: white;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
        }

        .clock-button i {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .clock-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .clock-button:hover::before {
            left: 100%;
        }

        .clock-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .clock-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .clock-button:disabled::before {
            display: none;
        }

        .clock-in { background: linear-gradient(135deg, #43CBFF, #9708CC); }
        .clock-out { background: linear-gradient(135deg, #F5515F, #9F041B); }
        .break-in { background: linear-gradient(135deg, #42E695, #3BB2B8); }
        .break-out { background: linear-gradient(135deg, #FDD819, #E80505); }
        .lunch-in { background: linear-gradient(135deg, #FFCF71, #2376DD); }
        .lunch-out { background: linear-gradient(135deg, #FF7CA8, #FF0169); }
        .bio-in { background: linear-gradient(135deg, #A0FE65, #FA016D); }
        .bio-out { background: linear-gradient(135deg, #FFE000, #799F0C); }
        .system-issue { background: linear-gradient(135deg, #FF416C, #FF4B2B); }
        .system-issue-active { background: linear-gradient(135deg, #0BA360, #3CBA92); }

        .state-indicators {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .state-indicators {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .state-indicator {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .state-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .state-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
        }

        .state-active {
            color: #43e97b;
        }

        .state-completed {
            color: #FFD700;
        }

        .state-inactive {
            color: #f5576c;
        }

        .state-overbreak {
            color: #FF6B6B;
            animation: pulse 1s infinite;
        }

        .employee-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #5ee7df, #b490ca);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            margin-right: 15px;
            font-weight: bold;
        }

        .employee-details {
            flex: 1;
        }

        .employee-name {
            font-size: 1.4rem;
            color: white;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .employee-id {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        .activity-log {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            max-height: 300px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
            margin-bottom: 20px;
        }

        .activity-log h3 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .log-entry {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .log-entry:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .log-action {
            color: #4ecdc4;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .log-time {
            color: white;
            font-size: 1rem;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 28px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }

        .notification i {
            margin-right: 15px;
            font-size: 1.8rem;
        }

        .notification.success {
            background: linear-gradient(135deg, #0BA360, #3CBA92);
            border-left: 5px solid #3CBA92;
        }

        .notification.error {
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
            border-left: 5px solid #FF416C;
        }

        .notification.warning {
            background: linear-gradient(135deg, #FDBB2D, #22C1C3);
            border-left: 5px solid #FDBB2D;
        }

        .notification.show {
            transform: translateX(0);
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.7); }
            70% { transform: scale(1.02); box-shadow: 0 0 0 15px rgba(78, 205, 196, 0); }
            100% { transform: scale(1); }
        }

        .floating-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .reset-button {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .reset-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .reset-button i {
            margin-right: 8px;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            padding: 50px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transform: scale(0.8);
            transition: transform 0.4s ease;
        }

        .popup-overlay.show .popup-content {
            transform: scale(1);
        }

        .popup-title {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 30px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 4s ease-in-out infinite;
        }

        .popup-message {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.6;
            margin-bottom: 40px;
            font-weight: 500;
        }

        .popup-close {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .popup-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .system-issue-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 5px solid #FF416C;
            display: none;
        }

        .system-issue-title {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .system-issue-time {
            font-size: 1.2rem;
            color: #FF416C;
            font-weight: bold;
        }

        .system-duration {
            font-size: 1.3rem;
            font-weight: bold;
            color: #FFD700;
            margin-top: 10px;
        }

        .sheets-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 0.9rem;
            color: #43e97b;
            z-index: 10;
        }

        /* Overbreak Alert Styles */
        .overbreak-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 3000;
            box-shadow: 0 25px 50px rgba(255, 65, 108, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            animation: alertPulse 1s infinite;
        }

        .overbreak-alert.show {
            opacity: 1;
            visibility: visible;
        }

        @keyframes alertPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        .overbreak-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .overbreak-message {
            font-size: 1.3rem;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .overbreak-time {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .break-timers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .break-timer {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .break-timer-label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .break-timer-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .break-timer.overbreak {
            background: rgba(255, 107, 107, 0.3);
            border: 2px solid #FF6B6B;
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particlesContainer"></div>
    
    <div class="container">
        <div class="sheets-status" id="sheetsStatus" onclick="testGoogleSheetsConnection()" style="cursor: pointer;" title="Click to test connection">
            <i class="fas fa-wifi"></i> Ready to connect
        </div>
        
        <div class="header">
            <h1 class="title">EMPLOYEE TIME CLOCK</h1>
            <div class="current-time" id="currentTime"></div>
        </div>

        <div class="employee-info">
            <div class="avatar" id="employeeAvatar">JD</div>
            <div class="employee-details">
                <div class="employee-name" id="employeeNameDisplay">John Doe</div>
                <div class="employee-id" id="employeeId">ID: EMP-001</div>
            </div>
        </div>

        <div class="employee-section">
            <input type="text" class="employee-input" id="employeeName" placeholder="Enter Employee Name or ID">
            
            <div class="state-indicators">
                <div class="state-indicator">
                    <div class="state-label">Clock Status</div>
                    <div class="state-value state-inactive" id="clockState">Not Clocked In</div>
                </div>
                <div class="state-indicator">
                    <div class="state-label">Break Status</div>
                    <div class="state-value state-inactive" id="breakState">Not Started</div>
                </div>
                <div class="state-indicator">
                    <div class="state-label">Lunch Status</div>
                    <div class="state-value state-inactive" id="lunchState">Not Started</div>
                </div>
                <div class="state-indicator">
                    <div class="state-label">System Issue</div>
                    <div class="state-value state-inactive" id="systemState">Not Started</div>
                </div>
            </div>

            <!-- Break Timers Display -->
            <div class="break-timers">
                <div class="break-timer" id="currentBreakTimer">
                    <div class="break-timer-label">Current Break</div>
                    <div class="break-timer-value" id="currentBreakTime">00:00</div>
                </div>
                <div class="break-timer" id="currentLunchTimer">
                    <div class="break-timer-label">Current Lunch</div>
                    <div class="break-timer-value" id="currentLunchTime">00:00</div>
                </div>
                <div class="break-timer" id="totalBreaksTimer">
                    <div class="break-timer-label">Total Breaks Used</div>
                    <div class="break-timer-value" id="totalBreaksTime">0 / 2</div>
                </div>
                <div class="break-timer" id="totalLunchTimer">
                    <div class="break-timer-label">Lunch Completed</div>
                    <div class="break-timer-value" id="totalLunchTime">No</div>
                </div>
            </div>

            <div class="button-grid">
                <button class="clock-button clock-in" onclick="clockAction('Clock In', this)" id="clockInBtn">
                    <i class="fas fa-sign-in-alt"></i> Clock In
                </button>
                <button class="clock-button system-issue" onclick="toggleSystemIssue()" id="systemIssueBtn" disabled>
                    <i class="fas fa-exclamation-triangle"></i> System Issue
                </button>
                <button class="clock-button clock-out" onclick="clockAction('Clock Out', this)" id="clockOutBtn" disabled>
                    <i class="fas fa-sign-out-alt"></i> Clock Out
                </button>
                <button class="clock-button break-in" onclick="clockAction('Break Start', this)" id="breakInBtn" disabled>
                    <i class="fas fa-coffee"></i> Break Start
                </button>
                <button class="clock-button break-out" onclick="clockAction('Break End', this)" id="breakOutBtn" disabled>
                    <i class="fas fa-coffee"></i> Break End
                </button>
                <button class="clock-button lunch-in" onclick="clockAction('Lunch Start', this)" id="lunchInBtn" disabled>
                    <i class="fas fa-utensils"></i> Lunch Start
                </button>
                <button class="clock-button lunch-out" onclick="clockAction('Lunch End', this)" id="lunchOutBtn" disabled>
                    <i class="fas fa-utensils"></i> Lunch End
                </button>
                <button class="clock-button bio-in" onclick="clockAction('Bio Break Start', this)" id="bioInBtn" disabled>
                    <i class="fas fa-restroom"></i> Bio Break Start
                </button>
                <button class="clock-button bio-out" onclick="clockAction('Bio Break End', this)" id="bioOutBtn" disabled>
                    <i class="fas fa-restroom"></i> Bio Break End
                </button>
            </div>

            <div class="system-issue-display" id="systemIssueDisplay">
                <div class="system-issue-title">Current System Issue</div>
                <div class="system-issue-time" id="systemIssueStartTime">Not started</div>
                <div class="system-duration" id="systemIssueDuration">Duration: 00:00:00</div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="reset-button" onclick="resetButtons()">
                    <i class="fas fa-sync-alt"></i> RESET ALL
                </button>
            </div>
        </div>

        <div class="activity-log">
            <h3>Today's Activity Log</h3>
            <div id="logEntries"></div>
        </div>
    </div>

    <!-- Thank You Popup -->
    <div class="popup-overlay" id="thankYouPopup">
        <div class="popup-content">
            <div class="popup-title">Thank You!</div>
            <div class="popup-message">
                Thank you for your hard work and for coming in today. We appreciate you!
            </div>
            <button class="popup-close" onclick="closeThankYouPopup()">
                <i class="fas fa-check"></i> CONTINUE
            </button>
        </div>
    </div>

    <!-- Overbreak Alert Popup -->
    <div class="overbreak-alert" id="overbreakAlert">
        <div class="overbreak-title">⚠️ OVERBREAK ALERT ⚠️</div>
        <div class="overbreak-message" id="overbreakMessage">You have exceeded your allotted break time!</div>
        <div class="overbreak-time" id="overbreakTime">Current time: 00:00</div>
        <button class="popup-close" onclick="closeOverbreakAlert()" style="background: rgba(255,255,255,0.3);">
            <i class="fas fa-check"></i> ACKNOWLEDGE
        </button>
    </div>

<script>
// Employee Database
const EMPLOYEE_DATABASE = {
    "maria theresa stephanie bamba": "2023-0020",
    "gina silvano": "2023-0021",
    "letty malasarte": "2023-0023",
    "luigi miguel ignacio": "2023-0031",
    "john kevin de leon": "2024-0222"
    // Add more employees as needed
};

// Configuration for Google Apps Script
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzDr5mFrrktaSBLJx4vw9lmvmsy7HYkch2LUVhCTkN_9maau3r-qArExB8DqWvps8i6/exec';

// Break time limits
const BREAK_LIMIT = 15;
const LUNCH_LIMIT = 60;
const MAX_BREAKS = 2;

// State management
const timeClockState = {
    clockedIn: false,
    clockInTime: null,
    breakStarted: false,
    breakCompleted: false,
    breakStartTime: null,
    breakCount: 0,
    totalBreakTime: 0,
    lunchStarted: false,
    lunchCompleted: false,
    lunchStartTime: null,
    lunchTotalTime: 0,
    bioBreakStarted: false,
    bioBreakStartTime: null,
    systemIssueStarted: false,
    systemIssueStartTime: null,
    systemIssueTimer: null,
    overbreakAlert: false
};

// DOM Elements
const employeeNameInput = document.getElementById('employeeName');
const employeeNameDisplay = document.getElementById('employeeNameDisplay');
const employeeIdDisplay = document.getElementById('employeeId');
const employeeAvatar = document.getElementById('employeeAvatar');
const clockState = document.getElementById('clockState');
const breakState = document.getElementById('breakState');
const lunchState = document.getElementById('lunchState');
const systemState = document.getElementById('systemState');
const clockInBtn = document.getElementById('clockInBtn');
const clockOutBtn = document.getElementById('clockOutBtn');
const breakInBtn = document.getElementById('breakInBtn');
const breakOutBtn = document.getElementById('breakOutBtn');
const lunchInBtn = document.getElementById('lunchInBtn');
const lunchOutBtn = document.getElementById('lunchOutBtn');
const bioInBtn = document.getElementById('bioInBtn');
const bioOutBtn = document.getElementById('bioOutBtn');
const systemIssueBtn = document.getElementById('systemIssueBtn');
const systemIssueDisplay = document.getElementById('systemIssueDisplay');
const systemIssueStartTime = document.getElementById('systemIssueStartTime');
const systemIssueDuration = document.getElementById('systemIssueDuration');
const logEntries = document.getElementById('logEntries');
const sheetsStatus = document.getElementById('sheetsStatus');

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    employeeNameInput.addEventListener('input', handleEmployeeInput);
    testGoogleSheetsConnection();
});

function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('currentTime').textContent = timeString;
}

function handleEmployeeInput() {
    const input = employeeNameInput.value.trim().toLowerCase();
    if (!input) {
        resetEmployeeDisplay();
        return;
    }

    // Find employee in database
    const employeeEntry = Object.entries(EMPLOYEE_DATABASE).find(([name]) => 
        name.toLowerCase().includes(input) || 
        EMPLOYEE_DATABASE[name].toLowerCase().includes(input)
    );

    if (employeeEntry) {
        const [fullName, id] = employeeEntry;
        employeeNameDisplay.textContent = fullName.split(' ').map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
        employeeIdDisplay.textContent = `ID: ${id}`;
        employeeAvatar.textContent = fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        
        // Enable clock in button
        clockInBtn.disabled = false;
    } else {
        resetEmployeeDisplay();
        clockInBtn.disabled = true;
    }
}

function resetEmployeeDisplay() {
    employeeNameDisplay.textContent = 'John Doe';
    employeeIdDisplay.textContent = 'ID: EMP-001';
    employeeAvatar.textContent = 'JD';
    clockInBtn.disabled = true;
}

async function clockAction(action, button) {
    try {
        // Get employee info
        const employeeName = employeeNameDisplay.textContent;
        const employeeId = employeeIdDisplay.textContent.replace('ID: ', '');
        
        // Prepare data
        const now = new Date();
        const data = {
            date: now.toLocaleDateString('en-US'),
            time: now.toLocaleTimeString('en-US'),
            employeeName: employeeName,
            employeeId: employeeId,
            action: action,
            duration: '',
            issueDescription: ''
        };

        // State-specific logic
        switch(action) {
            case 'Clock In':
                timeClockState.clockedIn = true;
                timeClockState.clockInTime = now;
                clockInBtn.disabled = true;
                clockOutBtn.disabled = false;
                breakInBtn.disabled = false;
                lunchInBtn.disabled = false;
                bioInBtn.disabled = false;
                systemIssueBtn.disabled = false;
                clockState.textContent = 'Clocked In';
                clockState.className = 'state-value state-active';
                break;
                
            case 'Clock Out':
                timeClockState.clockedIn = false;
                clockOutBtn.disabled = true;
                breakInBtn.disabled = true;
                lunchInBtn.disabled = true;
                bioInBtn.disabled = true;
                systemIssueBtn.disabled = true;
                clockState.textContent = 'Not Clocked In';
                clockState.className = 'state-value state-inactive';
                document.getElementById('thankYouPopup').classList.add('show');
                break;
                
            case 'Break Start':
                timeClockState.breakStarted = true;
                timeClockState.breakStartTime = now;
                breakInBtn.disabled = true;
                breakOutBtn.disabled = false;
                breakState.textContent = 'On Break';
                breakState.className = 'state-value state-active';
                break;
                
            case 'Break End':
                timeClockState.breakStarted = false;
                timeClockState.breakCompleted = true;
                timeClockState.breakCount++;
                breakInBtn.disabled = false;
                breakOutBtn.disabled = true;
                breakState.textContent = 'Break Completed';
                breakState.className = 'state-value state-completed';
                break;
                
            // Similar logic for Lunch, Bio Break, etc.
        }

        // Send data to Google Sheets
        const response = await sendDataToSheets(data);
        
        // Log activity
        addLogEntry(action);
        
        // Show success notification
        showNotification(`Action "${action}" recorded successfully!`, 'success');
        
    } catch (error) {
        console.error('Error in clockAction:', error);
        showNotification(`Failed to record action: ${error.message}`, 'error');
    }
}

async function sendDataToSheets(data) {
    try {
        const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error sending data to Sheets:', error);
        throw error;
    }
}

function addLogEntry(action) {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
        <span class="log-action">${action}</span>
        <span class="log-time">${timeString}</span>
    `;
    
    logEntries.prepend(logEntry);
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        ${message}
    `;
    
    document.body.appendChild(notification);
    
    // Show notification
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Hide after 3 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.remove();
        }, 400);
    }, 3000);
}

async function testGoogleSheetsConnection() {
    try {
        sheetsStatus.innerHTML = '<i class="fas fa-sync fa-spin"></i> Testing connection...';
        
        const testData = {
            date: 'Test Connection',
            time: new Date().toLocaleTimeString(),
            employeeName: 'Connection Test',
            employeeId: 'TEST-001',
            action: 'Connection Test',
            duration: '',
            issueDescription: ''
        };

        const response = await sendDataToSheets(testData);
        
        if (response && response.status === 'success') {
            sheetsStatus.innerHTML = '<i class="fas fa-check-circle"></i> Connected to Sheets';
            sheetsStatus.style.color = '#43e97b';
        } else {
            throw new Error('Invalid response from server');
        }
    } catch (error) {
        console.error('Sheets connection test failed:', error);
        sheetsStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Connection Failed';
        sheetsStatus.style.color = '#ff6b6b';
        showNotification('Failed to connect to Google Sheets. Check script permissions.', 'error');
    }
}

function resetButtons() {
    // Reset all buttons to initial state
    clockInBtn.disabled = false;
    clockOutBtn.disabled = true;
    breakInBtn.disabled = true;
    breakOutBtn.disabled = true;
    lunchInBtn.disabled = true;
    lunchOutBtn.disabled = true;
    bioInBtn.disabled = true;
    bioOutBtn.disabled = true;
    systemIssueBtn.disabled = true;
    
    // Reset state indicators
    clockState.textContent = 'Not Clocked In';
    clockState.className = 'state-value state-inactive';
    breakState.textContent = 'Not Started';
    breakState.className = 'state-value state-inactive';
    lunchState.textContent = 'Not Started';
    lunchState.className = 'state-value state-inactive';
    systemState.textContent = 'Not Started';
    systemState.className = 'state-value state-inactive';
    
    // Reset state object
    Object.keys(timeClockState).forEach(key => {
        if (typeof timeClockState[key] === 'boolean') {
            timeClockState[key] = false;
        } else if (typeof timeClockState[key] === 'number') {
            timeClockState[key] = 0;
        } else {
            timeClockState[key] = null;
        }
    });
    
    // Clear system issue timer
    if (timeClockState.systemIssueTimer) {
        clearInterval(timeClockState.systemIssueTimer);
        timeClockState.systemIssueTimer = null;
    }
    
    // Hide system issue display
    systemIssueDisplay.style.display = 'none';
    
    showNotification('All buttons and states have been reset', 'success');
}

function closeThankYouPopup() {
    document.getElementById('thankYouPopup').classList.remove('show');
}

function closeOverbreakAlert() {
    document.getElementById('overbreakAlert').classList.remove('show');
}

// Add this at the end to create floating particles
function createParticles() {
    const container = document.getElementById('particlesContainer');
    const particleCount = 50;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // Random position
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        
        // Random size
        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // Random animation delay
        particle.style.animationDelay = `${Math.random() * 15}s`;
        
        container.appendChild(particle);
    }
}

// Initialize particles
createParticles();
</script>